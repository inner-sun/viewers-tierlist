(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();class c{constructor(e,t){this.users=[],this.filteredUsers=[],this.STORAGE_KEY="tierlist-data",this.nextCustomUserId=1e6,this.container=e,this.searchInput=t,this.initializeUsers(),this.setupSearch(),this.render()}async initializeUsers(){try{const t=await(await fetch("viewers.json")).json();console.log(t),this.users=t.map(s=>({id:parseInt(s.user_uid),name:s.displayName||s.user_name,avatar:s.avatar,watchtime:parseInt(s.watchtime),message:parseInt(s.message),chatColor:s.chatColor})),this.removeAlreadyRankedUsers(),this.filteredUsers=[...this.users],this.render()}catch(e){console.error("Failed to load users:",e),this.users=[],this.filteredUsers=[]}}addCustomUser(e){const t={id:this.nextCustomUserId++,name:e,avatar:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==",message:0,watchtime:0,chatColor:"#FFFFFF"};this.users.push(t);const s=this.searchInput.value.toLowerCase();t.name.toLowerCase().includes(s)&&this.filteredUsers.push(t),this.render()}removeAlreadyRankedUsers(){const e=localStorage.getItem(this.STORAGE_KEY);if(e)try{const t=JSON.parse(e),s=new Set;t.forEach(r=>{r.users.forEach(a=>{s.add(a.id)})}),this.users=this.users.filter(r=>!s.has(r.id))}catch(t){console.error("Failed to load tiers from storage:",t)}}setupSearch(){this.searchInput.addEventListener("input",e=>{const t=e.target.value.toLowerCase();this.filteredUsers=this.users.filter(s=>s.name.toLowerCase().includes(t)),this.render()})}randomize(){for(let e=this.filteredUsers.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this.filteredUsers[e],this.filteredUsers[t]]=[this.filteredUsers[t],this.filteredUsers[e]]}this.render()}render(){this.container.innerHTML="",this.filteredUsers.forEach(e=>{const t=this.createUserElement(e);this.container.appendChild(t)})}createUserElement(e){const t=document.createElement("div");t.className="user-item",t.draggable=!0,t.dataset.userId=e.id.toString();const s=n=>n>=1e3?Math.round(n/1e3)+"k":n.toString(),r=Math.round(e.watchtime/3600),a=s(r),i=s(e.message);return t.innerHTML=`
      <img src="${e.avatar}" alt="${e.name}">
      <div class="user-info">
        <span class="user-name" style="--color: ${e.chatColor}">${e.name}</span>
        ${e.message>0?`<span class="user-messages">${i} messages</span>`:""}
        ${e.watchtime>0?`<span class="user-watchtime">${a} heures en stream</span>`:""}
      </div>
    `,t.addEventListener("dragstart",n=>{n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("user",JSON.stringify(e)),t.classList.add("dragging")}),t.addEventListener("dragend",()=>{t.classList.remove("dragging")}),t}removeUser(e){this.users=this.users.filter(t=>t.id!==e),this.filteredUsers=this.filteredUsers.filter(t=>t.id!==e),this.render()}addUser(e){this.users.find(t=>t.id===e.id)||(this.users.push(e),this.filteredUsers.push(e),this.render())}}class l{constructor(e){this.tiers=[],this.STORAGE_KEY="tierlist-data",this.container=e,this.loadFromStorage(),this.render()}loadFromStorage(){const e=localStorage.getItem(this.STORAGE_KEY);if(e)try{this.tiers=JSON.parse(e),this.dispatchUsersInTiers()}catch(t){console.error("Failed to load tiers from storage:",t),this.initializeDefaultTiers()}else this.initializeDefaultTiers()}dispatchUsersInTiers(){const e=[];this.tiers.forEach(t=>{e.push(...t.users)}),e.length>0&&window.dispatchEvent(new CustomEvent("removeUsersFromList",{detail:e}))}saveToStorage(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.tiers))}initializeDefaultTiers(){const e=[{name:"S",color:"linear-gradient(35deg, #1c0aa7, #8e01b1)"},{name:"A",color:"#da2e4d"},{name:"B",color:"#fb8006"},{name:"C",color:"#d3bb07"},{name:"D",color:"#468946"}];this.tiers=e.map((t,s)=>({id:`tier-${Date.now()}-${s}`,name:t.name,color:t.color,users:[]})),this.saveToStorage()}addTier(e,t){const s={id:`tier-${Date.now()}`,name:e,color:t,users:[]};this.tiers.push(s),this.saveToStorage(),this.render()}render(){this.container.innerHTML="",this.tiers.forEach(e=>{const t=this.createTierElement(e);this.container.appendChild(t)})}createTierElement(e){const t=document.createElement("div");t.className="tier-row",t.dataset.tierId=e.id;const s=document.createElement("div");s.className="tier-label",s.style.background=e.color,s.contentEditable="true",s.textContent=e.name,s.addEventListener("blur",()=>{e.name=s.textContent||e.name,this.saveToStorage()});const r=document.createElement("div");return r.className="tier-dropzone",e.users.forEach(a=>{const i=this.createTierUserElement(a);r.appendChild(i)}),this.setupDropzone(r,e),t.appendChild(s),t.appendChild(r),t}createTierUserElement(e){const t=document.createElement("div");return t.className="user-item",t.style=`--color: ${e.chatColor}`,t.draggable=!0,t.dataset.userId=e.id.toString(),t.innerHTML=`
            <img src="${e.avatar}" alt="${e.name}">
            <span class="user-name">${e.name}</span>
        `,t.addEventListener("dragstart",s=>{s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("user",JSON.stringify(e)),s.dataTransfer.setData("fromTier","true"),t.classList.add("dragging")}),t.addEventListener("dragend",()=>{t.classList.remove("dragging")}),t}setupDropzone(e,t){e.addEventListener("dragover",s=>{s.preventDefault(),e.classList.add("drag-over")}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",s=>{s.preventDefault(),e.classList.remove("drag-over");const r=s.dataTransfer.getData("user"),a=s.dataTransfer.getData("fromTier");if(r){const i=JSON.parse(r);a&&this.tiers.forEach(n=>{n.users=n.users.filter(d=>d.id!==i.id)}),t.users.find(n=>n.id===i.id)||(t.users.push(i),this.saveToStorage(),this.render(),a||window.dispatchEvent(new CustomEvent("userAddedToTier",{detail:i})))}})}}class m{constructor(){this.initializeComponents(),this.setupEventListeners()}initializeComponents(){const e=document.getElementById("users-list"),t=document.getElementById("user-search"),s=document.getElementById("tier-rows");this.userList=new c(e,t),this.tierList=new l(s)}setupExport(){document.getElementById("export-btn").addEventListener("click",()=>{const t=localStorage.getItem("tierlist-data");if(t){const s=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download="tierlist-data.txt",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}})}setupEventListeners(){this.setupTierModal(),this.setupUserModal(),this.setupExport(),window.addEventListener("userAddedToTier",e=>{const t=e;this.userList.removeUser(t.detail.id)}),window.addEventListener("removeUsersFromList",e=>{e.detail.forEach(s=>{this.userList.removeUser(s.id)})})}setupTierModal(){const e=document.getElementById("add-tier-btn"),t=document.getElementById("tier-modal"),s=document.getElementById("confirm-tier"),r=document.getElementById("cancel-tier"),a=document.getElementById("tier-name-input"),i=document.getElementById("tier-color-input");e.addEventListener("click",()=>{t.classList.add("active")}),s.addEventListener("click",()=>{const n=a.value.trim(),d=i.value;n&&(this.tierList.addTier(n,d),t.classList.remove("active"),a.value="",i.value="#808080")}),r.addEventListener("click",()=>{t.classList.remove("active"),a.value="",i.value="#808080"})}setupUserModal(){const e=document.getElementById("add-user-btn"),t=document.getElementById("user-modal"),s=document.getElementById("confirm-user"),r=document.getElementById("cancel-user"),a=document.getElementById("user-name-input");e.addEventListener("click",()=>{t.classList.add("active")}),s.addEventListener("click",()=>{const i=a.value.trim();i&&(this.userList.addCustomUser(i),t.classList.remove("active"),a.value="")}),r.addEventListener("click",()=>{t.classList.remove("active"),a.value=""})}}new m;
